---
stepsCompleted: ['step-01-init', 'step-02-discovery', 'step-02b-vision', 'step-02c-executive-summary', 'step-03-success', 'step-04-journeys', 'step-05-domain', 'step-06-innovation', 'step-07-project-type', 'step-08-scoping', 'step-09-functional', 'step-10-nonfunctional', 'step-11-polish', 'step-12-complete']
status: 'complete'
completedAt: '2026-02-18'
inputDocuments: []
workflowType: 'prd'
---

# Product Requirements Document

**Проєкт:** Система вибору тем курсових робіт
**Автор:** Ss
**Дата:** 2026-02-18

## Executive Summary

Навчальний заклад (~90 студентів, ~120 тем курсових робіт) розподіляє теми через email. Процес генерує хаотичну переписку через відсутність єдиного джерела правди про доступність тем. Система замінює цей процес єдиним веб-інструментом: студент бачить актуальний список вільних тем і резервує одну. Після резервації тема зникає зі списку для всіх. Система гарантує відсутність дублів навіть при одночасних запитах — студент отримує явну відмову якщо тема зайнята в момент запису. Адмін керує списками та вивантажує CSV зі статусом.

**Головна цінність:** атомарність операції вибору (нуль дублів) при нульовій вартості інфраструктури ($0/міс).

## Project Classification

- **Тип:** Web Application (SPA + REST API)
- **Домен:** Education / Internal Tooling (Greenfield)
- **Складність:** Medium-High — serverless race conditions, security layers, IaC
- **Стек:** React + Vite → Cloudflare Pages / Node.js Lambda + API Gateway HTTP API / MongoDB Atlas M0 / Terraform
- **Бюджет:** $0 (AWS Free Tier + Cloudflare Free)
- **Дедлайн:** 7 днів

## Success Criteria

### User Success

- Студент завершує вибір теми за ≤3 хвилини від першого входу
- Жоден студент не може вибрати більше однієї теми (hard constraint на рівні БД)
- При спробі вибрати вже зайняту тему — явне повідомлення про відмову, без silent failures
- Скасування вибору студентом неможливе — тільки адмін може звільнити тему

### Business Success

- 100% студентів проходять процес вибору без email-переписки з адміном
- Адмін може вивантажити CSV-статус у будь-який момент
- Запуск за 7 днів

### Technical Success

- $0 AWS bill (Free Tier: Lambda 1M req/міс, API Gateway 1M req/міс, S3 5GB)
- 0 дублів тем після повного розподілу
- Система витримує пік (~90 користувачів за один день)
- Всі дії логуються з IP (audit trail)

## User Journeys

### Journey 1: Студент — успішний вибір теми

**Персона:** Олена, 3-й курс. Отримала від адміна email з логіном і паролем. Відкриває ноут між парами.

1. Переходить за посиланням → сторінка логіну → вводить email + пароль → увійшла
2. Бачить список вільних тем. Клікає на тему → читає опис → натискає "Вибрати"
3. Підтвердження "Ви впевнені?" → підтверджує
4. Система резервує тему → "Ваша тема: [назва]. Для зміни — зверніться до адміна"
5. Закриває вкладку. Наступного разу зайде і побачить ту саму сторінку з підтвердженням

### Journey 2: Студент — race condition

**Персона:** Максим вибирає ту саму тему що й Олена — одночасно.

1. Бачить тему у списку (ще вільна) → клікає → читає опис → "Вибрати" → підтверджує
2. Сервер: операція програє Олені → повертає відмову
3. Максим бачить: "Цю тему щойно вибрав інший студент. Поверніться до списку"
4. Список оновлюється — теми вже немає. Вибирає іншу

### Journey 3: Студент — спроба обходу

**Персона:** Дмитро вже вибрав тему, хоче змінити.

1. Логіниться → бачить "Ваша тема: [назва]. Для зміни — зверніться до адміна"
2. Пробує прямий API запит на endpoint вибору → 403 Forbidden
3. Жодний обхід неможливий — блокування на рівні БД і API

### Journey 4: Адмін — підготовка та запуск

**Персона:** Викладач готує систему перед стартом вибору.

1. Логіниться як адмін → адмін-панель
2. Bulk upload студентів з CSV (ім'я, email) → система генерує паролі
3. Вивантажує CSV з credentials → копіпастить у власний email-клієнт, відправляє вручну
4. Bulk upload тем з CSV (назва, опис)
5. Перевіряє списки → все готово, студенти можуть входити

### Journey 5: Адмін — моніторинг і коригування

**Персона:** Той самий викладач, через день після старту.

1. Заходить → дашборд: 47/90 студентів вибрали тему
2. Студент телефонує: "Помилково вибрав не ту тему" → адмін: "Звільнити тему" → тема повертається у список, студент вибирає знову
3. Вивантажує CSV зі статусом → відправляє в деканат
4. Переглядає audit log → бачить підозрілу активність (5 невдалих логінів з одного IP)

## Functional Requirements

### Authentication & Authorization

- FR1: Студент може увійти в систему за email і паролем
- FR2: Адмін може увійти в систему за email і паролем
- FR3: Система розрізняє ролі `student` і `admin` та обмежує доступ відповідно
- FR4: Автентифікована сесія зберігається між переходами сторінок
- FR5: Користувач може вийти з системи
- FR6: Адмін може скинути пароль студента (генерує новий, доступний через CSV export)

### Topic Discovery & Selection (Student)

- FR7: Студент може переглядати список тільки вільних тем
- FR8: Студент може переглянути назву, опис, наукового керівника та кафедру будь-якої вільної теми до вибору
- FR9: Студент може вибрати одну тему зі списку
- FR10: Система гарантує що одну тему може вибрати рівно один студент
- FR11: При спробі вибрати вже зайняту тему студент отримує явне повідомлення про відмову
- FR12: Після вибору студент бачить підтвердження з назвою, описом, науковим керівником та кафедрою своєї теми
- FR13: Студент не може вибрати більше однієї теми
- FR14: Студент не може самостійно скасувати вибір теми
- FR15: При повторному вході студент бачить свою тему з повідомленням що зміна тільки через адміна

### User Management (Admin)

- FR16: Адмін може додати студента (ім'я, email)
- FR17: Адмін може видалити студента
- FR18: Адмін може завантажити список студентів з CSV-файлу (bulk upload)
- FR19: Система генерує пароль для кожного нового студента
- FR20: Адмін може вивантажити CSV з credentials студентів для ручної відправки

### Topic Management (Admin)

- FR21: Адмін може додати тему (назва, опис, науковий керівник, кафедра)
- FR22: Адмін може видалити тему
- FR23: Адмін може завантажити список тем з CSV-файлу (bulk upload); CSV містить колонки: `title, description, supervisor, department`
- FR24: Адмін може звільнити тему (повернути у список вільних)

### Reporting & Export

- FR25: Адмін може переглядати поточний статус всіх тем (назва, кафедра, керівник, вільна / зайнята + ким)
- FR26: Адмін може вивантажити поточний статус у форматі CSV; CSV містить колонки: `title, description, supervisor, department, studentName, studentEmail, status`
- FR27: Адмін може переглядати audit log дій у системі
- FR28: Адмін може вивантажити audit log у форматі CSV

### Audit & Logging

- FR29: Система логує кожен вхід (actor, timestamp, IP, result)
- FR30: Система логує кожну спробу вибору теми (actor, тема, timestamp, IP, result: success/denied)
- FR31: Система логує всі адмін-операції (тип операції, timestamp, IP)

## Non-Functional Requirements

### Performance

- NFR1: API відповідає на запити читання за ≤2с при нормальному навантаженні
- NFR2: Операція вибору теми завершується за ≤3с включно з lock-механізмом
- NFR3: Lambda cold start ≤5с — прийнятно для внутрішнього інструменту з низьким трафіком
- NFR4: Система витримує одночасну роботу ~90 студентів без деградації

### Security

- NFR5: Паролі зберігаються виключно у вигляді bcrypt hash (min cost factor 10)
- NFR6: JWT в httpOnly, Secure, SameSite=None cookie; термін дії ≤24h (SameSite=None обов'язковий через cross-origin frontend↔API; захист від CSRF через вузький CORS allow-origin)
- NFR7: Всі комунікації клієнт↔API по HTTPS
- NFR8: API Gateway throttling: ≤10 req/хв на auth endpoint з одного IP
- NFR9: Після N невдалих спроб логіну акаунт тимчасово блокується (N і тривалість TBD в архітектурі)
- NFR10: MongoDB Atlas M0 — доступ виключно через connection string в Lambda env vars; мережевий доступ `0.0.0.0/0` з обов'язковою TLS-аутентифікацією

### Reliability

- NFR11: Операція вибору теми або завершується успіхом, або повертає явну помилку — silent failure неприпустимий
- NFR12: При збої write-операції дані залишаються консистентними (no partial writes)
- NFR13: CSV export доступний завжди незалежно від стану ongoing selections

### Cost

- NFR14: Щомісячні витрати AWS ≤$0 (Free Tier: Lambda 1M req, API Gateway 1M req, S3 5GB)
- NFR15: Cloudflare Free tier — без платних features

## Technical Architecture

### Stack

| Шар | Технологія |
|---|---|
| Frontend | React + Vite → Cloudflare Pages |
| API | AWS Lambda (Node.js ESM) + API Gateway HTTP API |
| Database | MongoDB Atlas M0 (free tier, завжди онлайн) |
| Auth | email/password, bcrypt, JWT в httpOnly cookie |
| Edge | Cloudflare Free (DDoS, rate limiting, DNS) |
| IaC | Terraform, деплой з локалки |

### Auth Model

- Ролі: `student`, `admin`
- CORS: API Gateway дозволяє тільки origin Cloudflare Pages + `credentials: true`
- API routes: `/auth/*`, `/topics/*`, `/admin/*`, `/audit/*`
- Auth middleware на кожному захищеному маршруті

### Key Technical Risks

| Ризик | Мітигація |
|---|---|
| Race condition (одночасний вибір теми) | MongoDB `findOneAndUpdate` з умовою `selected_by: null` — атомарна операція на рівні документа |
| Lambda cold start | CloudWatch EventBridge ping кожні 10 хв тримає Lambda теплою; cold start ≤5с прийнятний |
| MongoDB Atlas IP whitelist | `0.0.0.0/0` з сильними кредами + TLS (URI тільки в Lambda env vars) |
| Terraform state втрата | `.gitignore` для `*.tfstate`, ручний backup перед деплоєм |
| Brute-force на auth | API Gateway throttling + app-level lockout (N спроб → тимчасовий бан) |

## Product Scope

### MVP — 7 днів

- Auth (email+password, httpOnly cookie JWT, ролі student/admin)
- Генерація паролів + CSV з credentials для ручної відправки адміном
- Список вільних тем з описами (тільки вільні)
- Атомарний вибір теми (race condition safe)
- Блокування повторного вибору; скасування тільки адміном
- Адмін CRUD студентів і тем; bulk upload (CSV); звільнення теми
- CSV-експорт статусу та audit log
- Audit log (всі дії з IP)
- Деплой: Terraform → AWS Lambda + API Gateway + Cloudflare Pages; MongoDB Atlas M0 (окремо)

### Growth (Post-MVP)

- Email-підтвердження студенту після вибору теми
- Дедлайн вибору (автозакриття після дати)
- Bulk-редагування тем

### Vision

- Мультизаклад / multi-tenant
- Інтеграція з Moodle
